<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japan Knowledge Quiz | æ—¥æœ¬ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚¿ã‚¯ã‚¤ã‚º</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Noto+Serif+JP:wght@400;700&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root{--primary:#333;--secondary:#555;--accent:#999;--bg:#F0F6FF;--text:#222;--shadow:rgba(0,0,0,0.06);--pink:#FFD1DC;--pink-dark:#E8A0B0;--blue:#BDE0FE;--blue-dark:#89B4D4;--mint:#C1F0DB;--mint-dark:#7CC9A3;--yellow:#FFF3B0;--lavender:#E8D5F5;--peach:#FFDAB9}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Patrick Hand','Noto Serif JP','Noto Serif SC',cursive,serif;background:var(--bg);color:var(--text);min-height:100vh}
        .header{background:#222;color:#fff;padding:20px 30px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;border-bottom:3px solid #333}
        .header h1{font-size:1.3rem} .header-right{display:flex;align-items:center;gap:15px}
        .header a{color:#ccc;text-decoration:none;font-size:.9rem}
        .lang-sw{display:flex;gap:4px}
        .lang-sw button{background:rgba(255,255,255,.15);color:#fff;border:1px solid rgba(255,255,255,.3);padding:5px 10px;font-size:.8rem;font-family:inherit;border-radius:20px;cursor:pointer}
        .lang-sw button:hover{background:rgba(255,255,255,.25)}
        .lang-sw button.active{background:#fff;border-color:#fff;color:#222;font-weight:bold}
        .container{max-width:850px;margin:40px auto;padding:0 20px}
        .sel-screen{text-align:center}
        .sel-screen h2{font-size:1.8rem;color:#333;margin-bottom:10px}
        .sel-screen>p{color:#666;margin-bottom:30px}
        .sec-label{color:#333;margin-bottom:15px;font-size:1.1rem}
        .cat-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-bottom:35px}
        .cat-card{background:#fff;border-radius:16px;padding:22px 15px;cursor:pointer;transition:all .3s;box-shadow:none;border:2.5px solid #333;text-align:center;border-top:4px solid var(--pink)}
        .cat-card:nth-child(2){border-top-color:var(--blue)}
        .cat-card:nth-child(3){border-top-color:var(--mint)}
        .cat-card:nth-child(4){border-top-color:var(--yellow)}
        .cat-card:nth-child(5){border-top-color:var(--lavender)}
        .cat-card:nth-child(6){border-top-color:var(--peach)}
        .cat-card:hover{transform:translateY(-4px);box-shadow:4px 4px 0px #333}
        .cat-card.selected{border-color:#333;box-shadow:4px 4px 0px #333}
        .cat-card .cat-icon{font-size:2.2rem;margin-bottom:8px}
        .cat-card h3{font-size:.95rem;color:#333}
        .cat-card p{font-size:.78rem;color:#999;margin-top:4px}
        .level-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-bottom:30px}
        .level-card{background:#fff;border-radius:16px;padding:22px 15px;cursor:pointer;transition:all .3s;box-shadow:none;border:2.5px solid #333;text-align:center;border-left:4px solid var(--mint)}
        .level-card:nth-child(2){border-left-color:var(--yellow)}
        .level-card:nth-child(3){border-left-color:var(--pink)}
        .level-card:hover{transform:translateY(-4px)} .level-card.selected{box-shadow:4px 4px 0px #333}
        .level-card .lv-icon{font-size:2rem;margin-bottom:6px}
        .level-card .lv-jp{font-size:1.3rem;color:#333;margin-bottom:4px}
        .level-card h3{font-size:.95rem;color:#555}
        .start-btn{background:var(--pink);color:#333;border:2.5px solid #333;padding:15px 50px;font-size:1.1rem;font-family:inherit;border-radius:30px;cursor:pointer;transition:all .3s;margin-top:10px;font-weight:700}
        .start-btn:hover{background:var(--pink-dark);transform:scale(1.03);box-shadow:3px 3px 0px #333} .start-btn:disabled{background:#eee;color:#bbb;cursor:not-allowed;transform:none;box-shadow:none;border-color:#ccc}
        .quiz-screen{display:none}
        .quiz-progress{display:flex;align-items:center;gap:15px;margin-bottom:25px}
        .prog-bg{flex:1;height:10px;background:#eee;border-radius:5px;overflow:hidden}
        .prog-fill{height:100%;background:linear-gradient(90deg,var(--pink),var(--blue));border-radius:5px;transition:width .4s}
        .prog-text{font-size:.9rem;color:#888;white-space:nowrap}
        .q-card{background:#fff;border-radius:16px;padding:35px;box-shadow:none;border:2.5px solid #333;margin-bottom:20px}
        .q-badge{display:inline-block;padding:4px 12px;border-radius:20px;font-size:.75rem;font-weight:bold;margin-bottom:15px;color:#333;background:var(--lavender);border:1.5px solid #333}
        .q-text{font-size:1.2rem;color:#333;margin-bottom:20px;line-height:1.5}
        .choices{display:grid;gap:12px}
        .ch-btn{background:#fff;border:2.5px solid #ddd;border-radius:12px;padding:14px 20px;font-size:1rem;font-family:inherit;cursor:pointer;transition:all .2s;text-align:left}
        .ch-btn:hover{border-color:#333;background:#f5f5f5}
        .ch-btn.correct{border-color:#2ecc71;background:#eafaf1;color:#27ae60}
        .ch-btn.wrong{border-color:#e74c3c;background:#fdecea;color:#c0392b}
        .ch-btn:disabled{cursor:default}
        .feedback{margin-top:15px;padding:12px 18px;border-radius:12px;font-size:.95rem;display:none}
        .feedback.correct{display:block;background:#eafaf1;color:#27ae60;border:1px solid #2ecc71}
        .feedback.wrong{display:block;background:#fdecea;color:#c0392b;border:1px solid #e74c3c}
        .trivia{margin-top:15px;padding:15px 18px;border-radius:12px;background:linear-gradient(135deg,#fff 60%,var(--yellow) 100%);border-left:4px solid var(--yellow);font-size:.9rem;color:#555;display:none;line-height:1.5;border:1.5px solid #eee;border-left:4px solid var(--yellow)}
        .trivia.show{display:block}
        .trivia-label{font-weight:bold;color:#555;margin-bottom:5px}
        .next-btn{display:none;margin-top:20px;background:var(--blue);color:#333;border:2px solid #333;padding:12px 35px;font-size:1rem;font-family:inherit;border-radius:30px;cursor:pointer;font-weight:700}
        .next-btn:hover{background:var(--blue-dark);box-shadow:3px 3px 0px #333}
        .results-screen{display:none;text-align:center}
        .res-card{background:#fff;border-radius:16px;padding:50px 40px;box-shadow:none;border:2.5px solid #333}
        .res-icon{font-size:4rem;margin-bottom:15px}
        .res-card h2{font-size:1.8rem;color:#333;margin-bottom:10px}
        .res-score{font-size:3.5rem;font-weight:bold;color:#333;margin:15px 0}
        .res-detail{font-size:1rem;color:#888;margin-bottom:25px}
        .res-msg{font-size:1.05rem;color:var(--text);margin-bottom:30px;padding:15px;background:#f5f5f5;border-radius:12px}
        .res-btns{display:flex;gap:15px;justify-content:center;flex-wrap:wrap}
        .res-btns button{padding:12px 30px;font-size:1rem;font-family:inherit;border-radius:30px;cursor:pointer;border:none;transition:all .3s}
        .retry-btn{background:var(--pink);color:#333;border:2px solid #333;font-weight:700} .retry-btn:hover{background:var(--pink-dark);box-shadow:3px 3px 0px #333}
        .back-btn{background:var(--mint);color:#333;border:2px solid #333;font-weight:700} .back-btn:hover{background:var(--mint-dark);box-shadow:3px 3px 0px #333}
        @media(max-width:768px){
            .cat-cards{grid-template-columns:repeat(2,1fr);gap:10px}
            .level-cards{grid-template-columns:1fr;gap:10px}
            .header{flex-direction:column;align-items:flex-start;padding:15px 20px;gap:8px}
            .header h1{font-size:1.1rem}
            .header-right{width:100%;justify-content:space-between}
            .container{margin:25px auto;padding:0 15px}
            .sel-screen h2{font-size:1.4rem}
            .sel-screen>p{font-size:.9rem;margin-bottom:20px}
            .cat-card{padding:15px 10px}
            .cat-card .cat-icon{font-size:1.8rem}
            .cat-card h3{font-size:.85rem}
            .level-card{padding:18px 12px}
            .q-card{padding:22px}
            .q-text{font-size:1.05rem}
            .res-card{padding:30px 20px}
            .res-score{font-size:2.8rem}
            .res-card h2{font-size:1.4rem}
            .start-btn{padding:13px 30px;font-size:1rem;width:100%}
            .res-btns{flex-direction:column;align-items:stretch}
            .res-btns button{width:100%}
            .next-btn{width:100%;text-align:center}
        }
        /* Cute cat & sakura decorations */
        @keyframes sakuraSway{0%,100%{transform:rotate(-5deg) scale(1)}50%{transform:rotate(5deg) scale(1.1)}}
        @keyframes pawFloat{0%,100%{opacity:.12;transform:translateY(0) rotate(-10deg)}50%{opacity:.2;transform:translateY(-5px) rotate(10deg)}}
        body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0;opacity:.07;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300' viewBox='0 0 300 300'%3E%3Cg fill='none' stroke='%23555' stroke-width='1'%3E%3Ccircle cx='25' cy='25' r='4.5' fill='%23555'/%3E%3Ccircle cx='17' cy='15' r='2.5' fill='%23555'/%3E%3Ccircle cx='25' cy='12' r='2.5' fill='%23555'/%3E%3Ccircle cx='33' cy='15' r='2.5' fill='%23555'/%3E%3Cellipse cx='100' cy='25' rx='4' ry='7' fill='%23FFD1DC' stroke='%23E8A0B0'  transform='rotate(20 100 25)'/%3E%3Cellipse cx='108' cy='20' rx='3' ry='6' fill='%23FFD1DC' stroke='%23E8A0B0' transform='rotate(-25 108 20)'/%3E%3Cellipse cx='94' cy='28' rx='3' ry='6' fill='%23FFD1DC' stroke='%23E8A0B0' transform='rotate(45 94 28)'/%3E%3Ccircle cx='100' cy='25' r='2.5' fill='%23FFF3B0'/%3E%3Cellipse cx='200' cy='40' rx='14' ry='17' fill='%23FFD1DC' stroke='%23555'/%3E%3Cellipse cx='200' cy='34' rx='9' ry='8' fill='%23FFF' stroke='%23555'/%3E%3Ccircle cx='196' cy='34' r='2' fill='%23555'/%3E%3Ccircle cx='204' cy='34' r='2' fill='%23555'/%3E%3Cpath d='M196 41c2 2 6 2 8 0' stroke='%23555'/%3E%3Ccircle cx='270' cy='30' r='4' fill='%2389B4D4'/%3E%3Ccircle cx='262' cy='20' r='2.5' fill='%2389B4D4'/%3E%3Ccircle cx='270' cy='17' r='2.5' fill='%2389B4D4'/%3E%3Ccircle cx='278' cy='20' r='2.5' fill='%2389B4D4'/%3E%3Ccircle cx='50' cy='120' r='10' fill='%23FFF' stroke='%23555'/%3E%3Cpath d='M41 112l4 8M59 112l-4 8' stroke='%23555'/%3E%3Ccircle cx='46' cy='118' r='1.5' fill='%23555'/%3E%3Ccircle cx='54' cy='118' r='1.5' fill='%23555'/%3E%3Cpath d='M47 123c2 2 4 2 6 0' stroke='%23555'/%3E%3Cpath d='M37 119h6M57 119h6' stroke='%23555' stroke-width='0.6'/%3E%3Cpath d='M145 110a18 18 0 0 1 30 0' fill='%23BDE0FE' stroke='%23555'/%3E%3Cline x1='160' y1='110' x2='160' y2='130' stroke='%23555'/%3E%3Cellipse cx='250' cy='120' rx='9' ry='14' fill='%23FFD1DC' stroke='%23555'/%3E%3Cline x1='250' y1='106' x2='250' y2='100' stroke='%23555'/%3E%3Cpath d='M241 120h18' stroke='%23555' stroke-width='0.5'/%3E%3Cpath d='M130 210l12-20 12 20z' fill='%23BDE0FE' stroke='%23555'/%3E%3Cpath d='M136 200l6-10 6 10' fill='%23FFF' stroke='none'/%3E%3Ccircle cx='30' cy='220' r='4' fill='%23E8A0B0'/%3E%3Ccircle cx='22' cy='210' r='2.5' fill='%23E8A0B0'/%3E%3Ccircle cx='30' cy='207' r='2.5' fill='%23E8A0B0'/%3E%3Ccircle cx='38' cy='210' r='2.5' fill='%23E8A0B0'/%3E%3Cellipse cx='230' cy='220' rx='12' ry='6' fill='%23FFD1DC' stroke='%23555'/%3E%3Cpath d='M242 220l8-6v12z' fill='%23FFD1DC' stroke='%23555'/%3E%3Ccircle cx='224' cy='218' r='1.5' fill='%23555'/%3E%3Cpath d='M270 280V250M290 280V250M267 252h26M267 260h26' stroke='%23E8A0B0' stroke-width='1.5'/%3E%3Cpath d='M264 249l2 3h30l2-3' stroke='%23E8A0B0' stroke-width='1.5' fill='none'/%3E%3Ccircle cx='60' cy='280' r='4' fill='%237CC9A3'/%3E%3Ccircle cx='52' cy='270' r='2.5' fill='%237CC9A3'/%3E%3Ccircle cx='60' cy='267' r='2.5' fill='%237CC9A3'/%3E%3Ccircle cx='68' cy='270' r='2.5' fill='%237CC9A3'/%3E%3Cpath d='M160 270l10-18 10 18z' fill='%23FFF' stroke='%23555'/%3E%3Cpath d='M162 270c0 4 16 4 16 0' fill='%23555'/%3E%3C/g%3E%3C/svg%3E");background-size:300px 300px}
        body::after{content:'ğŸŒ¸';position:fixed;top:15%;right:5%;font-size:1.5rem;opacity:.15;pointer-events:none;z-index:0;animation:sakuraSway 5s ease-in-out infinite}
        .container{position:relative;z-index:1}
        .sel-screen h2::before{content:'ğŸŒ¸ ';opacity:.4}
        .sel-screen h2::after{content:' ğŸŒ¸';opacity:.4}
        .sel-screen>p::after{content:' ğŸ¾';opacity:.3;font-size:.8rem}
        .sec-label::before{content:'ğŸ¾ ';opacity:.3;font-size:.8rem}
        .res-card::after{content:'ğŸŒ¸ ~(=^â€¥^) ğŸŒ¸';display:block;margin-top:20px;font-size:.85rem;color:#ccc;letter-spacing:2px}
        .q-card::before{content:'ğŸ±';position:absolute;top:-12px;right:15px;font-size:1rem;opacity:.3}
        .q-card::after{content:'ğŸŒ¸';position:absolute;bottom:-10px;left:15px;font-size:.9rem;opacity:.2;animation:sakuraSway 4s ease-in-out infinite}
        .q-card{position:relative;overflow:visible}
        .cat-cards::after{content:'ğŸ¾  ğŸ¾  ğŸ¾';position:absolute;bottom:-18px;left:50%;transform:translateX(-50%);font-size:.6rem;letter-spacing:10px;opacity:.12}
        .cat-cards{position:relative}
        .level-cards::after{content:'ğŸŒ¸ ğŸ¾ ğŸŒ¸';position:absolute;bottom:-15px;left:50%;transform:translateX(-50%);font-size:.6rem;letter-spacing:6px;opacity:.15}
        .level-cards{position:relative}
        .header::after{content:'ğŸ¾ ğŸŒ¸ ğŸ¾';position:absolute;bottom:-10px;left:50%;transform:translateX(-50%);font-size:.6rem;opacity:.2;letter-spacing:4px}
        .header{position:relative;overflow:visible}
        @media(max-width:480px){
            .cat-cards{grid-template-columns:1fr}
            .header h1{font-size:.95rem}
            .lang-sw button{padding:4px 7px;font-size:.72rem}
            .header a{font-size:.8rem}
            .q-text{font-size:.95rem}
            .ch-btn{padding:12px 14px;font-size:.92rem}
            .sel-screen h2{font-size:1.2rem}
            .sec-label{font-size:.95rem}
        }
    </style>
</head>
<body>
<div class="header">
    <h1 id="pageTitle">Japan Knowledge Quiz</h1>
    <div class="header-right">
        <div class="lang-sw">
            <button onclick="setLang('en')" id="langEn" class="active">EN</button>
            <button onclick="setLang('zh')" id="langZh">ä¸­æ–‡</button>
            <button onclick="setLang('ja')" id="langJa">æ—¥æœ¬èª</button>
            <button onclick="setLang('es')" id="langEs">ES</button>
        </div>
        <a href="index.html" id="backLink">â† Back</a>
    </div>
</div>
<div class="container">
    <div class="sel-screen" id="selScreen">
        <h2 id="mainTitle"></h2><p id="mainSub"></p>
        <h3 class="sec-label" id="catLabel"></h3>
        <div class="cat-cards" id="catCards"></div>
        <h3 class="sec-label" id="lvLabel"></h3>
        <div class="level-cards">
            <div class="level-card" onclick="selLevel('beginner')"><div class="lv-icon">ğŸŒ¸</div><div class="lv-jp">åˆç´š</div><h3 id="lBeg">Beginner</h3></div>
            <div class="level-card" onclick="selLevel('intermediate')"><div class="lv-icon">ğŸ‹</div><div class="lv-jp">ä¸­ç´š</div><h3 id="lMid">Intermediate</h3></div>
            <div class="level-card" onclick="selLevel('advanced')"><div class="lv-icon">ğŸ¯</div><div class="lv-jp">ä¸Šç´š</div><h3 id="lAdv">Advanced</h3></div>
        </div>
        <button class="start-btn" id="startBtn" disabled onclick="startQuiz()"></button>
    </div>
    <div class="quiz-screen" id="quizScreen">
        <div class="quiz-progress"><div class="prog-bg"><div class="prog-fill" id="progBar"></div></div><div class="prog-text" id="progText"></div></div>
        <div id="qArea"></div>
        <button class="next-btn" id="nextBtn" onclick="nextQ()"></button>
    </div>
    <div class="results-screen" id="resScreen">
        <div class="res-card">
            <div class="res-icon" id="resIcon"></div><h2 id="resTitle"></h2>
            <div class="res-score" id="resScore"></div><div class="res-detail" id="resDetail"></div>
            <div class="res-msg" id="resMsg"></div>
            <div class="res-btns">
                <button class="retry-btn" id="retryBtn" onclick="startQuiz()"></button>
                <button class="back-btn" id="backBtn" onclick="backToSel()"></button>
            </div>
        </div>
    </div>
</div>
<script>
let QUIZDATA = {};
let dataLoaded = false;

// Load questions: check localStorage (admin edits) first, then fetch JSON
(function loadData(){
  const local = localStorage.getItem('jcc-quiz-data');
  if (local) {
    try {
      QUIZDATA = JSON.parse(local);
      dataLoaded = true;
      updateUI();
      return;
    } catch(e) { /* fall through to fetch */ }
  }
  fetch('data/quiz-questions.json')
    .then(r => r.json())
    .then(data => {
      delete data._meta;
      QUIZDATA = data;
      dataLoaded = true;
      updateUI();
    })
    .catch(e => {
      console.error('Failed to load quiz data:', e);
      document.getElementById('mainSub').textContent = 'Error loading quiz data. Please refresh.';
    });
})();

const UI={
en:{pageTitle:"Japan Knowledge Quiz",backLink:"â† Back to Club Site",mainTitle:"How well do you know Japan?",mainSub:"Choose a category and difficulty level",catLabel:"Category",lvLabel:"Level",lBeg:"Beginner",lMid:"Intermediate",lAdv:"Advanced",startBtn:"Start Quiz",nextBtn:"Next â†’",seeRes:"See Results â†’",resTitle:"Results",retryBtn:"Retry",backBtn:"Change Category",excellent:"Amazing! You're a true Japan expert!",great:"Great job! You know Japan well!",notBad:"Not bad! Keep exploring Japan!",keepGoing:"Keep learning â€” Japan has so much to discover!",correct:" correct",triviaLabel:"Did you know?"},
zh:{pageTitle:"æ—¥æœ¬çŸ¥è¯†é—®ç­”",backLink:"â† è¿”å›ç¤¾å›¢ç½‘ç«™",mainTitle:"ä½ æœ‰å¤šäº†è§£æ—¥æœ¬ï¼Ÿ",mainSub:"é€‰æ‹©ä¸€ä¸ªç±»åˆ«å’Œéš¾åº¦ç­‰çº§",catLabel:"ç±»åˆ«",lvLabel:"ç­‰çº§",lBeg:"åˆçº§",lMid:"ä¸­çº§",lAdv:"é«˜çº§",startBtn:"å¼€å§‹ç­”é¢˜",nextBtn:"ä¸‹ä¸€é¢˜ â†’",seeRes:"æŸ¥çœ‹ç»“æœ â†’",resTitle:"æµ‹è¯•ç»“æœ",retryBtn:"å†è¯•ä¸€æ¬¡",backBtn:"æ›´æ¢ç±»åˆ«",excellent:"å¤ªæ£’äº†ï¼ä½ æ˜¯çœŸæ­£çš„æ—¥æœ¬é€šï¼",great:"å¾ˆå¥½ï¼ä½ å¯¹æ—¥æœ¬å¾ˆäº†è§£ï¼",notBad:"è¿˜ä¸é”™ï¼ç»§ç»­æ¢ç´¢æ—¥æœ¬å§ï¼",keepGoing:"ç»§ç»­å­¦ä¹ å§â€”â€”æ—¥æœ¬æœ‰å¤ªå¤šå€¼å¾—å‘ç°çš„ï¼",correct:" é¢˜æ­£ç¡®",triviaLabel:"ä½ çŸ¥é“å—ï¼Ÿ"},
ja:{pageTitle:"æ—¥æœ¬ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚¿ã‚¯ã‚¤ã‚º",backLink:"â† ã‚µã‚¤ãƒˆã«æˆ»ã‚‹",mainTitle:"æ—¥æœ¬ã‚’ã©ã‚Œã ã‘çŸ¥ã£ã¦ã‚‹ï¼Ÿ",mainSub:"ã‚«ãƒ†ã‚´ãƒªã¨é›£æ˜“åº¦ã‚’é¸ã‚“ã§ãã ã•ã„",catLabel:"ã‚«ãƒ†ã‚´ãƒª",lvLabel:"ãƒ¬ãƒ™ãƒ«",lBeg:"åˆç´š",lMid:"ä¸­ç´š",lAdv:"ä¸Šç´š",startBtn:"ã‚¯ã‚¤ã‚ºé–‹å§‹",nextBtn:"æ¬¡ã¸ â†’",seeRes:"çµæœã‚’è¦‹ã‚‹ â†’",resTitle:"ã‚¯ã‚¤ã‚ºçµæœ",retryBtn:"ã‚‚ã†ä¸€åº¦",backBtn:"ã‚«ãƒ†ã‚´ãƒªå¤‰æ›´",excellent:"ç´ æ™´ã‚‰ã—ã„ï¼æ—¥æœ¬é€šã§ã™ã­ï¼",great:"ã‚ˆãã§ãã¾ã—ãŸï¼æ—¥æœ¬ã«è©³ã—ã„ã§ã™ã­ï¼",notBad:"æ‚ªããªã„ã§ã™ï¼ã‚‚ã£ã¨æ—¥æœ¬ã‚’æ¢æ¤œã—ã¾ã—ã‚‡ã†ï¼",keepGoing:"å­¦ã³ç¶šã‘ã¾ã—ã‚‡ã†ï¼æ—¥æœ¬ã«ã¯ã¾ã ã¾ã ç™ºè¦‹ãŒãŸãã•ã‚“ï¼",correct:" å•æ­£è§£",triviaLabel:"è±†çŸ¥è­˜"},
es:{pageTitle:"Quiz sobre JapÃ³n",backLink:"â† Volver al sitio",mainTitle:"Â¿CuÃ¡nto sabes de JapÃ³n?",mainSub:"Elige una categorÃ­a y nivel de dificultad",catLabel:"CategorÃ­a",lvLabel:"Nivel",lBeg:"Principiante",lMid:"Intermedio",lAdv:"Avanzado",startBtn:"Iniciar quiz",nextBtn:"Siguiente â†’",seeRes:"Ver resultados â†’",resTitle:"Resultados",retryBtn:"Reintentar",backBtn:"Cambiar categorÃ­a",excellent:"Â¡IncreÃ­ble! Â¡Eres un experto en JapÃ³n!",great:"Â¡Buen trabajo! Â¡Conoces bien JapÃ³n!",notBad:"Â¡No estÃ¡ mal! Â¡Sigue explorando JapÃ³n!",keepGoing:"Â¡Sigue aprendiendo! Â¡JapÃ³n tiene mucho por descubrir!",correct:" correctas",triviaLabel:"Â¿SabÃ­as que...?"}
};
const CATS=[
{id:"current",icon:"ğŸ“°",en:"Current Events",zh:"æ—¶äº‹çƒ­ç‚¹",ja:"æ™‚äº‹ãƒã‚¿",es:"Actualidad"},
{id:"tourism",icon:"ğŸ—¾",en:"Tourism",zh:"è§‚å…‰æ—…æ¸¸",ja:"è¦³å…‰ãƒã‚¿",es:"Turismo"},
{id:"history",icon:"â›©ï¸",en:"History",zh:"å†å²",ja:"æ­´å²",es:"Historia"},
{id:"entertainment",icon:"ğŸ­",en:"Entertainment",zh:"å¨±ä¹",ja:"ã‚¨ãƒ³ã‚¿ãƒ¡",es:"Entretenimiento"},
{id:"manga",icon:"ğŸ“š",en:"Manga & Anime",zh:"æ¼«ç”»åŠ¨æ¼«",ja:"æ¼«ç”»ãƒ»ã‚¢ãƒ‹ãƒ¡",es:"Manga y Anime"},
{id:"food",icon:"ğŸ£",en:"Food",zh:"ç¾é£Ÿ",ja:"é£Ÿã¹ç‰©",es:"Comida"}
];
let lang='en',selCat=null,selLv=null,qs=[],qi=0,score=0,answered=false;

// Session tracking - prevent repeat questions within same browser session
function getSeenIds(){
  try{const s=sessionStorage.getItem('quizSeenIds');return s?JSON.parse(s):[];}catch(e){return[];}
}
function markSeen(id){
  const seen=getSeenIds();
  if(id&&!seen.includes(id)){seen.push(id);sessionStorage.setItem('quizSeenIds',JSON.stringify(seen));}
}

function t(k){return UI[lang][k]||UI.en[k]||k}
function setLang(l){lang=l;document.querySelectorAll('.lang-sw button').forEach(b=>b.classList.remove('active'));document.getElementById('lang'+l.charAt(0).toUpperCase()+l.slice(1)).classList.add('active');updateUI()}
function updateUI(){
['pageTitle','backLink','mainTitle','mainSub','catLabel','lvLabel','lBeg','lMid','lAdv','startBtn','retryBtn','backBtn','resTitle'].forEach(k=>{const e=document.getElementById(k);if(e)e.textContent=t(k)});
renderCats();
}
function renderCats(){
const c=document.getElementById('catCards');
c.innerHTML=CATS.map(cat=>`<div class="cat-card${selCat===cat.id?' selected':''}" onclick="selCategory('${cat.id}')"><div class="cat-icon">${cat.icon}</div><h3>${cat[lang]||cat.en}</h3></div>`).join('');
}
function selCategory(id){selCat=id;renderCats();updateStart()}
function selLevel(lv){selLv=lv;document.querySelectorAll('.level-card').forEach((c,i)=>c.classList.toggle('selected',['beginner','intermediate','advanced'][i]===lv));updateStart()}
function updateStart(){document.getElementById('startBtn').disabled=!(selCat&&selLv)}
function startQuiz(){
const pool=QUIZDATA[selCat]&&QUIZDATA[selCat][selLv];
if(!pool||!pool.length){alert('No questions available');return}
// Session tracking: prioritize unseen questions
const seen=getSeenIds();
const unseen=pool.filter(q=>!seen.includes(q.id));
const seenPool=pool.filter(q=>seen.includes(q.id));
let selected;
if(unseen.length>=10){selected=shuffle([...unseen]).slice(0,10);}
else{selected=[...shuffle([...unseen]),...shuffle([...seenPool])].slice(0,10);}
qs=selected;qi=0;score=0;
document.getElementById('selScreen').style.display='none';
document.getElementById('quizScreen').style.display='block';
document.getElementById('resScreen').style.display='none';
showQ();
}
function showQ(){
answered=false;const q=qs[qi],total=qs.length;
document.getElementById('progBar').style.width=(qi/total*100)+'%';
document.getElementById('progText').textContent=(qi+1)+' / '+total;
document.getElementById('nextBtn').style.display='none';
const qText=q.q[lang]||q.q.en;
const catObj=CATS.find(c=>c.id===selCat);
let h=`<div class="q-card"><span class="q-badge">${catObj?catObj.icon+' '+(catObj[lang]||catObj.en):''}</span><p class="q-text">${esc(qText)}</p><div class="choices">`;
q.c.forEach((c,i)=>{const lb=c[lang]||c.en;h+=`<button class="ch-btn" onclick="check(${i},${q.a},this)" data-i="${i}">${esc(lb)}</button>`});
h+=`</div><div class="feedback" id="fb"></div><div class="trivia" id="trivia"><div class="trivia-label">${t('triviaLabel')}</div><div id="triviaText"></div></div></div>`;
document.getElementById('qArea').innerHTML=h;
}
function check(s,a,btn){
if(answered)return;answered=true;
const q=qs[qi];
markSeen(q.id);
document.querySelectorAll('.ch-btn').forEach(b=>{b.disabled=true;const i=+b.dataset.i;if(i===a)b.classList.add('correct');if(i===s&&s!==a)b.classList.add('wrong')});
const fb=document.getElementById('fb');
if(s===a){score++;fb.className='feedback correct';fb.textContent=t('correctFeedback')||'âœ“ Correct!';}
else{const cl=q.c[a][lang]||q.c[a].en;fb.className='feedback wrong';fb.textContent=(t('wrongFeedback')||'âœ— Incorrect. Answer: ')+cl}
if(q.trivia){const tr=q.trivia[lang]||q.trivia.en;document.getElementById('triviaText').textContent=tr;document.getElementById('trivia').classList.add('show')}
const nb=document.getElementById('nextBtn');nb.style.display='inline-block';nb.textContent=qi<qs.length-1?t('nextBtn'):t('seeRes');
}
function nextQ(){qi++;if(qi>=qs.length)showRes();else showQ()}
function showRes(){
document.getElementById('quizScreen').style.display='none';
document.getElementById('resScreen').style.display='block';
const total=qs.length,pct=Math.round(score/total*100);
document.getElementById('resScore').textContent=pct+'%';
document.getElementById('resDetail').textContent=score+' / '+total+t('correct');
document.getElementById('resTitle').textContent=t('resTitle');
document.getElementById('retryBtn').textContent=t('retryBtn');
document.getElementById('backBtn').textContent=t('backBtn');
let icon,msg;
if(pct>=90){icon='ğŸ‰';msg=t('excellent')}else if(pct>=70){icon='ğŸ˜Š';msg=t('great')}else if(pct>=50){icon='ğŸ“š';msg=t('notBad')}else{icon='ğŸ’ª';msg=t('keepGoing')}
document.getElementById('resIcon').textContent=icon;document.getElementById('resMsg').textContent=msg;
}
function backToSel(){selCat=null;selLv=null;document.querySelectorAll('.level-card,.cat-card').forEach(c=>c.classList.remove('selected'));document.getElementById('startBtn').disabled=true;document.getElementById('selScreen').style.display='block';document.getElementById('quizScreen').style.display='none';document.getElementById('resScreen').style.display='none';renderCats()}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}
function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML}
updateUI();
</script>
</body>
</html>
