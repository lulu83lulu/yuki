<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | JCC „Ç¶„Çß„ÉÉ„ÉñÊó•Êú¨ÊñáÂåñÈÉ®</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif:ital,wght@0,400;0,700;1,400&family=Noto+Serif+JP:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* --- Admin Page Specific Styles --- */
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .admin-header {
            background: linear-gradient(180deg, #1a0a00 0%, #2d1810 50%, #3d2317 100%);
            padding: 20px 0;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
        }

        .admin-header .container {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .admin-header h1 {
            color: #fff;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-header .back-link {
            color: var(--accent);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .admin-header .back-link:hover {
            color: #fff;
        }

        /* Login Screen */
        .login-screen {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
        }

        .login-box {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 50px 40px;
            box-shadow: 0 8px 30px var(--shadow);
            border: 1px solid rgba(212, 168, 67, 0.2);
            max-width: 420px;
            width: 100%;
            text-align: center;
        }

        .login-box .login-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .login-box h2 {
            color: var(--secondary);
            margin-bottom: 8px;
            font-size: 1.5rem;
        }

        .login-box .login-subtitle {
            color: #888;
            font-size: 0.85rem;
            margin-bottom: 30px;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .input-group {
            text-align: left;
        }

        .input-group label {
            display: block;
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.95rem;
            transition: border-color var(--transition);
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .login-btn {
            padding: 14px;
            background: var(--primary);
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 700;
            transition: all var(--transition);
            margin-top: 10px;
        }

        .login-btn:hover {
            background: #a01830;
            transform: translateY(-1px);
        }

        .login-error {
            color: var(--primary);
            font-size: 0.85rem;
            margin-top: 10px;
            display: none;
        }

        /* Dashboard */
        .dashboard {
            display: none;
            flex: 1;
            padding: 30px 0;
        }

        .dashboard.active {
            display: block;
        }

        .dash-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 25px;
        }

        /* Sidebar */
        .dash-sidebar {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px var(--shadow);
            border: 1px solid rgba(212, 168, 67, 0.15);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .dash-sidebar h3 {
            color: var(--secondary);
            margin-bottom: 15px;
            font-size: 1rem;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 8px;
        }

        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .sidebar-nav button {
            text-align: left;
            padding: 10px 15px;
            background: transparent;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9rem;
            color: var(--text);
            transition: all var(--transition);
        }

        .sidebar-nav button:hover {
            background: rgba(196, 30, 58, 0.08);
            color: var(--primary);
        }

        .sidebar-nav button.active {
            background: var(--primary);
            color: #fff;
        }

        .sidebar-user {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            font-size: 0.8rem;
            color: #888;
        }

        .sidebar-user strong {
            color: var(--secondary);
        }

        .logout-btn {
            margin-top: 10px;
            width: 100%;
            padding: 8px;
            background: #666;
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.8rem;
            transition: all var(--transition);
        }

        .logout-btn:hover {
            background: #444;
        }

        /* Main Content Area */
        .dash-main {
            min-height: 500px;
        }

        .dash-panel {
            display: none;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 15px var(--shadow);
            border: 1px solid rgba(212, 168, 67, 0.15);
        }

        .dash-panel.active {
            display: block;
        }

        .dash-panel h2 {
            color: var(--secondary);
            margin-bottom: 20px;
            font-size: 1.4rem;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 10px;
        }

        /* Stats Cards */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--secondary), #1a3a4a);
            border-radius: 10px;
            padding: 20px;
            color: #fff;
            text-align: center;
        }

        .stat-card.red {
            background: linear-gradient(135deg, var(--primary), #8B0000);
        }

        .stat-card.gold {
            background: linear-gradient(135deg, #8B6914, var(--accent));
        }

        .stat-number {
            font-size: 2.2rem;
            font-weight: 700;
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.85;
            margin-top: 5px;
        }

        /* Activity Management */
        .create-form {
            background: rgba(245, 240, 232, 0.5);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px dashed var(--accent);
        }

        .create-form h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }

        .form-row.full {
            grid-template-columns: 1fr;
        }

        .create-form input,
        .create-form textarea,
        .create-form select {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.9rem;
            transition: border-color var(--transition);
        }

        .create-form input:focus,
        .create-form textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .create-form textarea {
            min-height: 80px;
            resize: vertical;
        }

        .create-form .submit-btn {
            padding: 12px 30px;
            background: var(--primary);
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.95rem;
            font-weight: 700;
            transition: all var(--transition);
        }

        .create-form .submit-btn:hover {
            background: #a01830;
        }

        /* Activity List Table */
        .activity-table {
            width: 100%;
            border-collapse: collapse;
        }

        .activity-table th {
            text-align: left;
            padding: 12px 15px;
            background: var(--secondary);
            color: #fff;
            font-size: 0.85rem;
            font-weight: 700;
        }

        .activity-table th:first-child {
            border-radius: 6px 0 0 0;
        }

        .activity-table th:last-child {
            border-radius: 0 6px 0 0;
        }

        .activity-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            font-size: 0.88rem;
        }

        .activity-table tr:hover td {
            background: rgba(245, 240, 232, 0.5);
        }

        .table-status {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .table-actions {
            display: flex;
            gap: 6px;
        }

        .table-actions button {
            padding: 5px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.78rem;
            transition: all var(--transition);
        }

        .btn-toggle {
            background: var(--secondary);
            color: #fff;
        }

        .btn-toggle:hover {
            background: #1a3040;
        }

        .btn-delete {
            background: #ff5252;
            color: #fff;
        }

        .btn-delete:hover {
            background: #d32f2f;
        }

        /* Site Settings */
        .settings-section {
            margin-bottom: 25px;
        }

        .settings-section h3 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .settings-section p {
            color: #666;
            font-size: 0.88rem;
            margin-bottom: 15px;
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .settings-item label {
            font-size: 0.9rem;
            color: var(--text);
        }

        .settings-item .hint {
            font-size: 0.75rem;
            color: #888;
        }

        /* No activities message */
        .no-activities {
            text-align: center;
            padding: 40px 20px;
            color: #888;
        }

        .no-activities .icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--secondary);
            color: #fff;
            padding: 14px 24px;
            border-radius: 8px;
            font-size: 0.9rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.4s ease;
            z-index: 9999;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            background: #2E7D32;
        }

        .toast.error {
            background: var(--primary);
        }

        /* Quiz Management Styles */
        .quiz-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        .quiz-stat {
            background: var(--bg);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid #e0d8cc;
        }
        .quiz-stat .qs-num { font-size: 1.6rem; font-weight: 700; color: var(--secondary); }
        .quiz-stat .qs-label { font-size: .75rem; color: #888; margin-top: 3px; }
        .quiz-stat.warning .qs-num { color: var(--primary); }
        .size-bar-bg { width: 100%; height: 8px; background: #ddd; border-radius: 4px; margin-top: 8px; }
        .size-bar-fill { height: 100%; border-radius: 4px; background: var(--secondary); transition: width .3s; }
        .size-bar-fill.warn { background: #e67e22; }
        .size-bar-fill.danger { background: var(--primary); }
        .quiz-toolbar {
            display: flex; gap: 10px; flex-wrap: wrap; align-items: center;
            margin-bottom: 20px; padding: 15px; background: var(--bg);
            border-radius: 8px; border: 1px solid #e0d8cc;
        }
        .quiz-toolbar select, .quiz-toolbar input {
            padding: 8px 12px; border: 2px solid #ddd; border-radius: 6px;
            font-family: inherit; font-size: .85rem;
        }
        .quiz-toolbar select:focus, .quiz-toolbar input:focus { outline: none; border-color: var(--primary); }
        .quiz-toolbar .spacer { flex: 1; }
        .quiz-toolbar button {
            padding: 8px 16px; border: none; border-radius: 6px;
            cursor: pointer; font-family: inherit; font-size: .85rem;
            font-weight: 700; transition: all var(--transition);
        }
        .btn-add { background: var(--primary); color: #fff; }
        .btn-add:hover { background: #a01830; }
        .btn-export-quiz { background: var(--secondary); color: #fff; }
        .btn-export-quiz:hover { background: #1a3040; }
        .quiz-list { max-height: 600px; overflow-y: auto; }
        .q-item {
            background: #fff; border: 1px solid #e0d8cc; border-radius: 8px;
            padding: 15px 18px; margin-bottom: 10px; transition: all .2s;
        }
        .q-item:hover { box-shadow: 0 3px 12px var(--shadow); }
        .q-item-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; }
        .q-item-meta { display: flex; gap: 6px; margin-bottom: 8px; flex-wrap: wrap; }
        .q-badge-sm {
            display: inline-block; padding: 2px 8px; border-radius: 10px;
            font-size: .7rem; font-weight: 700; color: #fff;
        }
        .q-badge-cat { background: var(--secondary); }
        .q-badge-lv { background: var(--accent); color: #2C2C2C; }
        .q-item-text { font-size: .9rem; color: var(--text); margin-bottom: 8px; line-height: 1.4; }
        .q-item-actions { display: flex; gap: 6px; }
        .q-item-actions button {
            padding: 4px 10px; border: none; border-radius: 4px;
            cursor: pointer; font-family: inherit; font-size: .75rem;
        }
        .q-no-items { text-align: center; padding: 40px; color: #888; }
        /* Quiz Edit Modal */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,.5); z-index: 10000;
            justify-content: center; align-items: center; padding: 20px;
        }
        .modal-overlay.show { display: flex; }
        .modal {
            background: #fff; border-radius: 12px; padding: 30px;
            max-width: 700px; width: 100%; max-height: 85vh; overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,.3);
        }
        .modal h3 { color: var(--secondary); margin-bottom: 20px; font-size: 1.2rem; }
        .modal-field { margin-bottom: 14px; }
        .modal-field label { display: block; font-size: .8rem; color: #666; font-weight: 700; margin-bottom: 4px; }
        .modal-field input, .modal-field textarea, .modal-field select {
            width: 100%; padding: 10px 14px; border: 2px solid #ddd; border-radius: 6px;
            font-family: inherit; font-size: .9rem;
        }
        .modal-field textarea { min-height: 60px; resize: vertical; }
        .modal-field input:focus, .modal-field textarea:focus { outline: none; border-color: var(--primary); }
        .modal-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .modal-btns { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
        .modal-btns button {
            padding: 10px 24px; border: none; border-radius: 6px; cursor: pointer;
            font-family: inherit; font-size: .9rem; font-weight: 700;
        }
        .modal-save { background: var(--primary); color: #fff; }
        .modal-save:hover { background: #a01830; }
        .modal-cancel { background: #ddd; color: var(--text); }
        .modal-cancel:hover { background: #ccc; }
        .choices-editor { margin-top: 8px; }
        .choice-row { display: flex; gap: 8px; align-items: center; margin-bottom: 6px; }
        .choice-row input { flex: 1; padding: 8px 10px; }
        .choice-row .choice-num { font-size: .8rem; color: #888; min-width: 20px; }

        /* Responsive */
        @media (max-width: 768px) {
            .dash-grid {
                grid-template-columns: 1fr;
            }

            .dash-sidebar {
                position: static;
                padding: 18px;
            }

            .sidebar-nav {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 6px;
            }

            .sidebar-nav button {
                padding: 8px 12px;
                font-size: 0.82rem;
                flex: 1;
                min-width: auto;
                text-align: center;
            }

            .stats-row {
                grid-template-columns: 1fr 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            /* Table scroll wrapper */
            #activityTableContainer {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .activity-table {
                font-size: 0.78rem;
                min-width: 520px;
            }

            .activity-table th,
            .activity-table td {
                padding: 8px 8px;
                white-space: nowrap;
            }

            .activity-table td:first-child {
                white-space: normal;
                min-width: 140px;
            }

            .admin-header h1 {
                font-size: 1rem;
            }

            .admin-header .container {
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }

            .dash-panel {
                padding: 20px;
            }

            .quiz-stats {
                grid-template-columns: 1fr;
            }

            .quiz-toolbar {
                flex-direction: column;
                align-items: stretch;
            }

            .quiz-toolbar select,
            .quiz-toolbar input {
                width: 100%;
            }

            .quiz-toolbar .spacer {
                display: none;
            }

            .quiz-toolbar button {
                width: 100%;
            }

            .modal {
                padding: 20px;
                max-height: 90vh;
            }

            .modal-row {
                grid-template-columns: 1fr;
            }

            .modal-btns {
                flex-direction: column;
            }

            .modal-btns button {
                width: 100%;
            }

            .q-item-header {
                flex-direction: column;
            }

            .q-item-actions {
                align-self: flex-end;
            }

            .login-box {
                padding: 30px 20px;
            }

            .stat-number {
                font-size: 1.6rem;
            }
        }

        @media (max-width: 480px) {
            .stats-row {
                grid-template-columns: 1fr;
            }

            .sidebar-nav button {
                font-size: 0.75rem;
                padding: 7px 8px;
            }

            .dash-panel {
                padding: 15px;
            }

            .create-form {
                padding: 15px;
            }

            .stat-number {
                font-size: 1.4rem;
            }

            .qs-num {
                font-size: 1.3rem;
            }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <div class="admin-header">
        <div class="container">
            <h1>‚õ©Ô∏è Admin Panel ‚Äî JCCÁÆ°ÁêÜÁîªÈù¢</h1>
            <a href="index.html" class="back-link">‚Üê Back to Site</a>
        </div>
    </div>

    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <div class="login-icon">üîê</div>
            <h2>Admin Login</h2>
            <p class="login-subtitle">Japanese Culture Club ‚Äî ÁÆ°ÁêÜËÄÖ„É≠„Ç∞„Ç§„É≥</p>
            <form class="login-form" id="loginForm">
                <div class="input-group">
                    <label>Username</label>
                    <input type="text" id="loginUsername" placeholder="Enter username" autocomplete="username" required>
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter password" autocomplete="current-password" required>
                </div>
                <button type="submit" class="login-btn">Login „É≠„Ç∞„Ç§„É≥</button>
                <p class="login-error" id="loginError">Invalid username or password</p>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <div class="container">
            <div class="dash-grid">
                <!-- Sidebar -->
                <div class="dash-sidebar">
                    <h3>‚õ©Ô∏è Dashboard</h3>
                    <nav class="sidebar-nav">
                        <button class="active" data-panel="overview">üìä Overview</button>
                        <button data-panel="activities">üó≥Ô∏è Activities</button>
                        <button data-panel="quiz">üß† Quiz Manager</button>
                        <button data-panel="settings">‚öôÔ∏è Settings</button>
                    </nav>
                    <div class="sidebar-user">
                        <p>Logged in as:</p>
                        <p><strong>Yuki Suto (ÈÉ®Èï∑)</strong></p>
                        <button class="logout-btn" id="logoutBtn">Logout „É≠„Ç∞„Ç¢„Ç¶„Éà</button>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="dash-main">
                    <!-- Overview Panel -->
                    <div class="dash-panel active" id="panel-overview">
                        <h2>üìä Overview ‚Äî Ê¶ÇË¶Å</h2>
                        <div class="stats-row">
                            <div class="stat-card">
                                <div class="stat-number" id="statTotal">0</div>
                                <div class="stat-label">Total Activities</div>
                            </div>
                            <div class="stat-card red">
                                <div class="stat-number" id="statOpen">0</div>
                                <div class="stat-label">Open Votes</div>
                            </div>
                            <div class="stat-card gold">
                                <div class="stat-number" id="statQuizQ">0</div>
                                <div class="stat-label">Quiz Questions</div>
                            </div>
                        </div>

                        <h3 style="color: var(--secondary); margin-bottom: 15px;">Recent Activities</h3>
                        <div id="recentActivities">
                            <div class="no-activities">
                                <div class="icon">üìã</div>
                                <p>No activities yet. Create one in the Activities panel!</p>
                            </div>
                        </div>
                    </div>

                    <!-- Activities Panel -->
                    <div class="dash-panel" id="panel-activities">
                        <h2>üó≥Ô∏è Activity Management ‚Äî Ê¥ªÂãïÁÆ°ÁêÜ</h2>

                        <div class="create-form">
                            <h3>‚ûï Create New Activity</h3>
                            <div class="form-row">
                                <div>
                                    <input type="text" id="newTitle" placeholder="Activity title / Ê¥ªÂãï„Çø„Ç§„Éà„É´">
                                </div>
                                <div>
                                    <input type="date" id="newDate">
                                </div>
                            </div>
                            <div class="form-row full">
                                <textarea id="newDesc" placeholder="Activity description / Ê¥ªÂãï„ÅÆË™¨Êòé"></textarea>
                            </div>
                            <button class="submit-btn" id="createBtn">Create Activity ‰ΩúÊàê</button>
                        </div>

                        <div id="activityTableContainer">
                            <table class="activity-table">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Votes (üëç/üëé)</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="activityTableBody">
                                </tbody>
                            </table>
                            <div class="no-activities" id="noActivitiesMsg">
                                <div class="icon">üó≥Ô∏è</div>
                                <p>No activities created yet.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quiz Management Panel -->
                    <div class="dash-panel" id="panel-quiz">
                        <h2>üß† Quiz Management ‚Äî „ÇØ„Ç§„Ç∫ÁÆ°ÁêÜ</h2>

                        <div class="quiz-stats">
                            <div class="quiz-stat">
                                <div class="qs-num" id="qsTotalQ">‚Äî</div>
                                <div class="qs-label">Total Questions ÂïèÈ°åÊï∞</div>
                            </div>
                            <div class="quiz-stat">
                                <div class="qs-num" id="qsCats">‚Äî</div>
                                <div class="qs-label">Categories „Ç´„ÉÜ„Ç¥„É™</div>
                            </div>
                            <div class="quiz-stat" id="qsSizeCard">
                                <div class="qs-num" id="qsSize">‚Äî</div>
                                <div class="qs-label">Data Size / 50MB</div>
                                <div class="size-bar-bg"><div class="size-bar-fill" id="qsSizeBar" style="width:0%"></div></div>
                            </div>
                        </div>

                        <div class="quiz-toolbar">
                            <select id="qFilterCat">
                                <option value="">All Categories</option>
                                <option value="current">üì∞ Current Events</option>
                                <option value="tourism">üóæ Tourism</option>
                                <option value="history">‚õ©Ô∏è History</option>
                                <option value="entertainment">üé≠ Entertainment</option>
                                <option value="manga">üìö Manga & Anime</option>
                                <option value="food">üç£ Food</option>
                            </select>
                            <select id="qFilterLv">
                                <option value="">All Levels</option>
                                <option value="beginner">üå∏ Beginner</option>
                                <option value="intermediate">üéã Intermediate</option>
                                <option value="advanced">üèØ Advanced</option>
                            </select>
                            <input type="text" id="qSearch" placeholder="Search questions...">
                            <div class="spacer"></div>
                            <button class="btn-add" onclick="openAddModal()">+ Add Question</button>
                            <button class="btn-export-quiz" onclick="exportQuizJSON()">‚¨á Export JSON</button>
                        </div>

                        <div class="quiz-list" id="quizList">
                            <div class="q-no-items">Loading quiz data...</div>
                        </div>
                    </div>

                    <!-- Quiz Edit/Add Modal -->
                    <div class="modal-overlay" id="qModal">
                        <div class="modal">
                            <h3 id="qModalTitle">Add Question</h3>
                            <input type="hidden" id="qEditId">

                            <div class="modal-row">
                                <div class="modal-field">
                                    <label>Category „Ç´„ÉÜ„Ç¥„É™</label>
                                    <select id="qmCat">
                                        <option value="current">üì∞ Current Events</option>
                                        <option value="tourism">üóæ Tourism</option>
                                        <option value="history">‚õ©Ô∏è History</option>
                                        <option value="entertainment">üé≠ Entertainment</option>
                                        <option value="manga">üìö Manga & Anime</option>
                                        <option value="food">üç£ Food</option>
                                    </select>
                                </div>
                                <div class="modal-field">
                                    <label>Level „É¨„Éô„É´</label>
                                    <select id="qmLv">
                                        <option value="beginner">üå∏ Beginner</option>
                                        <option value="intermediate">üéã Intermediate</option>
                                        <option value="advanced">üèØ Advanced</option>
                                    </select>
                                </div>
                            </div>

                            <div class="modal-field">
                                <label>Question (English)</label>
                                <input type="text" id="qmQen" placeholder="Enter question in English">
                            </div>
                            <div class="modal-row">
                                <div class="modal-field">
                                    <label>Question (Êó•Êú¨Ë™û)</label>
                                    <input type="text" id="qmQja" placeholder="Êó•Êú¨Ë™û„ÅßË≥™Âïè">
                                </div>
                                <div class="modal-field">
                                    <label>Question (‰∏≠Êñá)</label>
                                    <input type="text" id="qmQzh" placeholder="‰∏≠ÊñáÈóÆÈ¢ò">
                                </div>
                            </div>
                            <div class="modal-field">
                                <label>Question (Espa√±ol)</label>
                                <input type="text" id="qmQes" placeholder="Pregunta en espa√±ol">
                            </div>

                            <div class="modal-field">
                                <label>Choices (4 options ‚Äî enter for each language)</label>
                                <div class="choices-editor" id="choicesEditor"></div>
                            </div>

                            <div class="modal-field">
                                <label>Correct Answer Ê≠£Ëß£</label>
                                <select id="qmAns">
                                    <option value="0">Choice 1</option>
                                    <option value="1">Choice 2</option>
                                    <option value="2">Choice 3</option>
                                    <option value="3">Choice 4</option>
                                </select>
                            </div>

                            <div class="modal-field">
                                <label>Trivia / Ë±ÜÁü•Ë≠ò (English)</label>
                                <textarea id="qmTen" placeholder="Fun fact about this question"></textarea>
                            </div>
                            <div class="modal-row">
                                <div class="modal-field">
                                    <label>Trivia (Êó•Êú¨Ë™û)</label>
                                    <textarea id="qmTja" placeholder="Ë±ÜÁü•Ë≠ò"></textarea>
                                </div>
                                <div class="modal-field">
                                    <label>Trivia (‰∏≠Êñá)</label>
                                    <textarea id="qmTzh" placeholder="Ë∂£Âë≥Áü•ËØÜ"></textarea>
                                </div>
                            </div>
                            <div class="modal-field">
                                <label>Trivia (Espa√±ol)</label>
                                <textarea id="qmTes" placeholder="Dato curioso"></textarea>
                            </div>

                            <div class="modal-btns">
                                <button class="modal-cancel" onclick="closeModal()">Cancel</button>
                                <button class="modal-save" onclick="saveQuestion()">Save ‰øùÂ≠ò</button>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Panel -->
                    <div class="dash-panel" id="panel-settings">
                        <h2>‚öôÔ∏è Settings ‚Äî Ë®≠ÂÆö</h2>

                        <div class="settings-section">
                            <h3>Firebase Connection</h3>
                            <p>Status of the real-time database connection.</p>
                            <div class="settings-item">
                                <div>
                                    <label>Firebase Status</label>
                                    <div class="hint" id="firebaseStatus">Checking...</div>
                                </div>
                                <span id="firebaseIndicator">‚è≥</span>
                            </div>
                            <div class="settings-item">
                                <div>
                                    <label>Storage Mode</label>
                                    <div class="hint" id="storageMode">‚Äî</div>
                                </div>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>Data Management</h3>
                            <p>Manage local activity data.</p>
                            <div class="settings-item">
                                <div>
                                    <label>Clear All Activities</label>
                                    <div class="hint">This will remove all activities and votes from local storage.</div>
                                </div>
                                <button class="btn-delete" id="clearAllBtn" style="padding: 8px 16px;">Clear All</button>
                            </div>
                            <div class="settings-item">
                                <div>
                                    <label>Export Data</label>
                                    <div class="hint">Download all activity data as JSON.</div>
                                </div>
                                <button class="btn-toggle" id="exportBtn" style="padding: 8px 16px;">Export</button>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>About</h3>
                            <div class="settings-item">
                                <div>
                                    <label>The Webb Schools Japanese Culture Club</label>
                                    <div class="hint">Admin Panel v1.0 ‚Äî Built for Yuki Suto</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
    /* ========================================
       Admin Panel Logic
       ======================================== */

    // Credentials
    const VALID_USERNAME = 'yuki';
    const VALID_PASSWORD = 'yuki0801';
    const LOCAL_STORAGE_KEY = 'jcc-activities';
    const SESSION_KEY = 'jcc-admin-session';

    // Elements
    const loginScreen = document.getElementById('loginScreen');
    const dashboard = document.getElementById('dashboard');
    const loginForm = document.getElementById('loginForm');
    const loginError = document.getElementById('loginError');

    /* --- Session --- */
    function checkSession() {
        if (sessionStorage.getItem(SESSION_KEY) === 'authenticated') {
            showDashboard();
        }
    }

    /* --- Login --- */
    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const username = document.getElementById('loginUsername').value.trim();
        const password = document.getElementById('loginPassword').value;

        if (username === VALID_USERNAME && password === VALID_PASSWORD) {
            sessionStorage.setItem(SESSION_KEY, 'authenticated');
            loginError.style.display = 'none';
            showDashboard();
            showToast('Welcome, Yuki! „Çà„ÅÜ„Åì„ÅùÔºÅ', 'success');
        } else {
            loginError.style.display = 'block';
            document.getElementById('loginPassword').value = '';
        }
    });

    /* --- Logout --- */
    document.getElementById('logoutBtn').addEventListener('click', () => {
        sessionStorage.removeItem(SESSION_KEY);
        dashboard.classList.remove('active');
        loginScreen.style.display = 'flex';
        document.getElementById('loginUsername').value = '';
        document.getElementById('loginPassword').value = '';
        showToast('Logged out successfully', 'success');
    });

    function showDashboard() {
        loginScreen.style.display = 'none';
        dashboard.classList.add('active');
        refreshDashboard();
    }

    /* --- Sidebar Navigation --- */
    document.querySelectorAll('.sidebar-nav button').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.sidebar-nav button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.querySelectorAll('.dash-panel').forEach(p => p.classList.remove('active'));
            document.getElementById('panel-' + btn.dataset.panel).classList.add('active');
        });
    });

    /* --- Activities CRUD --- */
    function getActivities() {
        try {
            return JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY)) || {};
        } catch { return {}; }
    }

    function saveActivities(data) {
        localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(data));
    }

    // Create
    document.getElementById('createBtn').addEventListener('click', () => {
        const title = document.getElementById('newTitle').value.trim();
        const desc = document.getElementById('newDesc').value.trim();
        const date = document.getElementById('newDate').value;

        if (!title) {
            showToast('Please enter a title', 'error');
            return;
        }

        const activities = getActivities();
        const id = 'act_' + Date.now();
        activities[id] = {
            title,
            description: desc,
            date: date || new Date().toISOString().split('T')[0],
            status: 'open',
            votesFor: {},
            votesAgainst: {},
            createdAt: Date.now()
        };

        saveActivities(activities);
        document.getElementById('newTitle').value = '';
        document.getElementById('newDesc').value = '';
        document.getElementById('newDate').value = '';
        refreshDashboard();
        showToast('Activity created! Ê¥ªÂãï„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü', 'success');
    });

    // Toggle status
    function toggleStatus(id) {
        const activities = getActivities();
        if (activities[id]) {
            activities[id].status = activities[id].status === 'open' ? 'closed' : 'open';
            saveActivities(activities);
            refreshDashboard();
            showToast('Status updated', 'success');
        }
    }

    // Delete
    function deleteActivity(id) {
        if (!confirm('Delete this activity? „Åì„ÅÆÊ¥ªÂãï„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;
        const activities = getActivities();
        delete activities[id];
        saveActivities(activities);
        refreshDashboard();
        showToast('Activity deleted ÂâäÈô§„Åó„Åæ„Åó„Åü', 'success');
    }

    /* --- Refresh Dashboard --- */
    function refreshDashboard() {
        const activities = getActivities();
        const ids = Object.keys(activities).sort((a, b) =>
            (activities[b].createdAt || 0) - (activities[a].createdAt || 0)
        );

        // Stats
        let totalVotes = 0;
        let openCount = 0;
        ids.forEach(id => {
            const a = activities[id];
            totalVotes += Object.keys(a.votesFor || {}).length + Object.keys(a.votesAgainst || {}).length;
            if (a.status === 'open') openCount++;
        });

        document.getElementById('statTotal').textContent = ids.length;
        document.getElementById('statOpen').textContent = openCount;
        document.getElementById('statQuizQ').textContent = countQuestions();

        // Recent Activities (overview)
        const recentDiv = document.getElementById('recentActivities');
        if (ids.length === 0) {
            recentDiv.innerHTML = '<div class="no-activities"><div class="icon">üìã</div><p>No activities yet.</p></div>';
        } else {
            let html = '<div style="overflow-x:auto;-webkit-overflow-scrolling:touch"><table class="activity-table"><thead><tr><th>Title</th><th>Date</th><th>Status</th><th>Votes</th></tr></thead><tbody>';
            ids.slice(0, 5).forEach(id => {
                const a = activities[id];
                const f = Object.keys(a.votesFor || {}).length;
                const ag = Object.keys(a.votesAgainst || {}).length;
                const statusClass = a.status === 'open' ? 'status-open' : 'status-closed';
                const statusText = a.status === 'open' ? 'OPEN' : 'CLOSED';
                html += `<tr>
                    <td>${escapeHtml(a.title)}</td>
                    <td>${a.date || '‚Äî'}</td>
                    <td><span class="table-status ${statusClass}">${statusText}</span></td>
                    <td>üëç ${f} / üëé ${ag}</td>
                </tr>`;
            });
            html += '</tbody></table></div>';
            recentDiv.innerHTML = html;
        }

        // Activity Table (management)
        const tbody = document.getElementById('activityTableBody');
        const noMsg = document.getElementById('noActivitiesMsg');

        if (ids.length === 0) {
            tbody.innerHTML = '';
            noMsg.style.display = 'block';
        } else {
            noMsg.style.display = 'none';
            let rows = '';
            ids.forEach(id => {
                const a = activities[id];
                const f = Object.keys(a.votesFor || {}).length;
                const ag = Object.keys(a.votesAgainst || {}).length;
                const statusClass = a.status === 'open' ? 'status-open' : 'status-closed';
                const statusText = a.status === 'open' ? 'OPEN' : 'CLOSED';
                const toggleText = a.status === 'open' ? 'Close' : 'Open';
                rows += `<tr>
                    <td><strong>${escapeHtml(a.title)}</strong>${a.description ? '<br><small style="color:#888">' + escapeHtml(a.description).slice(0, 60) + '...</small>' : ''}</td>
                    <td>${a.date || '‚Äî'}</td>
                    <td><span class="table-status ${statusClass}">${statusText}</span></td>
                    <td>üëç ${f} / üëé ${ag}</td>
                    <td class="table-actions">
                        <button class="btn-toggle" onclick="toggleStatus('${id}')">${toggleText}</button>
                        <button class="btn-delete" onclick="deleteActivity('${id}')">Delete</button>
                    </td>
                </tr>`;
            });
            tbody.innerHTML = rows;
        }

        // Settings - Firebase status
        updateFirebaseStatus();
    }

    function updateFirebaseStatus() {
        const statusEl = document.getElementById('firebaseStatus');
        const indicator = document.getElementById('firebaseIndicator');
        const modeEl = document.getElementById('storageMode');

        if (typeof firebaseReady !== 'undefined' && firebaseReady) {
            statusEl.textContent = 'Connected';
            indicator.textContent = 'üü¢';
            modeEl.textContent = 'Firebase Realtime Database';
        } else {
            statusEl.textContent = 'Not configured';
            indicator.textContent = 'üü°';
            modeEl.textContent = 'Local Storage (localStorage)';
        }
    }

    /* --- Clear All --- */
    document.getElementById('clearAllBtn').addEventListener('click', () => {
        if (!confirm('Delete ALL activities and votes? This cannot be undone.\n„Åô„Åπ„Å¶„ÅÆÊ¥ªÂãï„Å®ÊäïÁ•®„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;
        localStorage.removeItem(LOCAL_STORAGE_KEY);
        refreshDashboard();
        showToast('All data cleared', 'success');
    });

    /* --- Export --- */
    document.getElementById('exportBtn').addEventListener('click', () => {
        const data = getActivities();
        const json = JSON.stringify(data, null, 2);
        const blob = new Blob([json], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'jcc-activities-' + new Date().toISOString().split('T')[0] + '.json';
        a.click();
        URL.revokeObjectURL(url);
        showToast('Data exported!', 'success');
    });

    /* --- Toast --- */
    function showToast(message, type = '') {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.className = 'toast ' + type;
        setTimeout(() => toast.classList.add('show'), 10);
        setTimeout(() => toast.classList.remove('show'), 3000);
    }

    /* --- Escape HTML --- */
    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    /* ========================================
       Quiz Management Logic
       ======================================== */
    const QUIZ_JSON_PATH = 'data/quiz-questions.json';
    const QUIZ_LOCAL_KEY = 'jcc-quiz-data';
    const MAX_SIZE_BYTES = 50 * 1024 * 1024; // 50MB
    const CAT_NAMES = {
        current: 'üì∞ Current Events',
        tourism: 'üóæ Tourism',
        history: '‚õ©Ô∏è History',
        entertainment: 'üé≠ Entertainment',
        manga: 'üìö Manga & Anime',
        food: 'üç£ Food'
    };
    const LV_NAMES = { beginner: 'üå∏ Beginner', intermediate: 'üéã Intermediate', advanced: 'üèØ Advanced' };
    let quizData = null; // working copy

    function loadQuizData() {
        // Try localStorage first (admin edits), then fetch JSON
        const local = localStorage.getItem(QUIZ_LOCAL_KEY);
        if (local) {
            try {
                quizData = JSON.parse(local);
                renderQuizPanel();
                return;
            } catch(e) { /* fall through */ }
        }
        fetch(QUIZ_JSON_PATH)
            .then(r => { if (!r.ok) throw new Error('HTTP ' + r.status); return r.json(); })
            .then(data => {
                delete data._meta;
                quizData = data;
                localStorage.setItem(QUIZ_LOCAL_KEY, JSON.stringify(quizData));
                renderQuizPanel();
            })
            .catch(e => {
                console.error('Failed to load quiz data:', e);
                document.getElementById('quizList').innerHTML = '<div class="q-no-items">Failed to load quiz data. Check data/quiz-questions.json</div>';
            });
    }

    function saveQuizLocal() {
        localStorage.setItem(QUIZ_LOCAL_KEY, JSON.stringify(quizData));
    }

    function getQuizSizeBytes() {
        return new Blob([JSON.stringify(quizData)]).size;
    }

    function countQuestions() {
        let total = 0;
        if (!quizData) return 0;
        Object.keys(quizData).forEach(cat => {
            Object.keys(quizData[cat]).forEach(lv => {
                total += quizData[cat][lv].length;
            });
        });
        return total;
    }

    function getAllQuestions() {
        const all = [];
        if (!quizData) return all;
        Object.keys(quizData).forEach(cat => {
            Object.keys(quizData[cat]).forEach(lv => {
                quizData[cat][lv].forEach(q => {
                    all.push({ ...q, _cat: cat, _lv: lv });
                });
            });
        });
        return all;
    }

    function renderQuizPanel() {
        if (!quizData) return;
        const total = countQuestions();
        const cats = Object.keys(quizData).length;
        const sizeBytes = getQuizSizeBytes();
        const sizeMB = (sizeBytes / (1024 * 1024)).toFixed(2);
        const pct = Math.min((sizeBytes / MAX_SIZE_BYTES) * 100, 100);

        document.getElementById('qsTotalQ').textContent = total;
        document.getElementById('qsCats').textContent = cats;
        document.getElementById('qsSize').textContent = sizeMB + ' MB';

        const sizeBar = document.getElementById('qsSizeBar');
        sizeBar.style.width = pct + '%';
        sizeBar.className = 'size-bar-fill' + (pct > 90 ? ' danger' : pct > 70 ? ' warn' : '');

        const sizeCard = document.getElementById('qsSizeCard');
        if (pct > 90) {
            sizeCard.classList.add('warning');
            showToast('‚ö†Ô∏è Quiz data is near 50MB limit! (' + sizeMB + ' MB)', 'error');
        } else {
            sizeCard.classList.remove('warning');
        }

        renderQuizList();
    }

    function renderQuizList() {
        const filterCat = document.getElementById('qFilterCat').value;
        const filterLv = document.getElementById('qFilterLv').value;
        const search = document.getElementById('qSearch').value.toLowerCase().trim();
        let items = getAllQuestions();

        if (filterCat) items = items.filter(q => q._cat === filterCat);
        if (filterLv) items = items.filter(q => q._lv === filterLv);
        if (search) items = items.filter(q => {
            const text = (q.q.en || '') + (q.q.ja || '') + (q.q.zh || '') + (q.q.es || '');
            return text.toLowerCase().includes(search);
        });

        const container = document.getElementById('quizList');
        if (items.length === 0) {
            container.innerHTML = '<div class="q-no-items">No questions found.</div>';
            return;
        }

        let html = '';
        items.forEach(q => {
            const qText = q.q.en || q.q.ja || '(no text)';
            const choices = q.c.map((c, i) => {
                const label = c.en || c.ja || '';
                return (i === q.a ? '<strong>' + escapeHtml(label) + ' ‚úì</strong>' : escapeHtml(label));
            }).join(' / ');
            html += `<div class="q-item">
                <div class="q-item-meta">
                    <span class="q-badge-sm q-badge-cat">${CAT_NAMES[q._cat] || q._cat}</span>
                    <span class="q-badge-sm q-badge-lv">${LV_NAMES[q._lv] || q._lv}</span>
                    <span style="font-size:.7rem;color:#aaa">${escapeHtml(q.id || '')}</span>
                </div>
                <div class="q-item-header">
                    <div class="q-item-text">${escapeHtml(qText)}</div>
                    <div class="q-item-actions">
                        <button class="btn-toggle" onclick="openEditModal('${q.id}')">Edit</button>
                        <button class="btn-delete" onclick="deleteQuestion('${q.id}')">Delete</button>
                    </div>
                </div>
                <div style="font-size:.78rem;color:#888">${choices}</div>
            </div>`;
        });
        container.innerHTML = html;
    }

    // Filters
    document.getElementById('qFilterCat').addEventListener('change', renderQuizList);
    document.getElementById('qFilterLv').addEventListener('change', renderQuizList);
    document.getElementById('qSearch').addEventListener('input', renderQuizList);

    // Build choices editor HTML
    function buildChoicesEditor(choices) {
        const langs = ['en', 'ja', 'zh', 'es'];
        const langLabels = { en: 'EN', ja: 'JA', zh: 'ZH', es: 'ES' };
        let html = '';
        for (let i = 0; i < 4; i++) {
            html += `<div style="margin-bottom:10px;padding:8px;background:var(--bg);border-radius:6px"><strong style="font-size:.8rem">Choice ${i + 1}</strong><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:4px;margin-top:4px">`;
            langs.forEach(l => {
                const val = choices && choices[i] ? (choices[i][l] || '') : '';
                html += `<input type="text" id="qmC${i}${l}" placeholder="${langLabels[l]}" value="${escapeHtml(val)}" style="padding:6px 8px;font-size:.82rem">`;
            });
            html += '</div></div>';
        }
        document.getElementById('choicesEditor').innerHTML = html;
    }

    // Modal
    function openAddModal() {
        document.getElementById('qModalTitle').textContent = 'Add Question ÂïèÈ°åËøΩÂä†';
        document.getElementById('qEditId').value = '';
        document.getElementById('qmCat').value = 'current';
        document.getElementById('qmLv').value = 'beginner';
        document.getElementById('qmQen').value = '';
        document.getElementById('qmQja').value = '';
        document.getElementById('qmQzh').value = '';
        document.getElementById('qmQes').value = '';
        document.getElementById('qmTen').value = '';
        document.getElementById('qmTja').value = '';
        document.getElementById('qmTzh').value = '';
        document.getElementById('qmTes').value = '';
        document.getElementById('qmAns').value = '0';
        buildChoicesEditor(null);
        document.getElementById('qModal').classList.add('show');
    }

    function openEditModal(id) {
        const q = findQuestionById(id);
        if (!q) { showToast('Question not found', 'error'); return; }
        document.getElementById('qModalTitle').textContent = 'Edit Question ÂïèÈ°åÁ∑®ÈõÜ';
        document.getElementById('qEditId').value = id;
        document.getElementById('qmCat').value = q._cat;
        document.getElementById('qmLv').value = q._lv;
        document.getElementById('qmQen').value = q.q.en || '';
        document.getElementById('qmQja').value = q.q.ja || '';
        document.getElementById('qmQzh').value = q.q.zh || '';
        document.getElementById('qmQes').value = q.q.es || '';
        document.getElementById('qmTen').value = (q.trivia && q.trivia.en) || '';
        document.getElementById('qmTja').value = (q.trivia && q.trivia.ja) || '';
        document.getElementById('qmTzh').value = (q.trivia && q.trivia.zh) || '';
        document.getElementById('qmTes').value = (q.trivia && q.trivia.es) || '';
        document.getElementById('qmAns').value = String(q.a);
        buildChoicesEditor(q.c);
        document.getElementById('qModal').classList.add('show');
    }

    function closeModal() {
        document.getElementById('qModal').classList.remove('show');
    }

    function findQuestionById(id) {
        if (!quizData) return null;
        for (const cat of Object.keys(quizData)) {
            for (const lv of Object.keys(quizData[cat])) {
                const q = quizData[cat][lv].find(q => q.id === id);
                if (q) return { ...q, _cat: cat, _lv: lv };
            }
        }
        return null;
    }

    function removeQuestionById(id) {
        for (const cat of Object.keys(quizData)) {
            for (const lv of Object.keys(quizData[cat])) {
                const idx = quizData[cat][lv].findIndex(q => q.id === id);
                if (idx >= 0) { quizData[cat][lv].splice(idx, 1); return true; }
            }
        }
        return false;
    }

    function saveQuestion() {
        const cat = document.getElementById('qmCat').value;
        const lv = document.getElementById('qmLv').value;
        const qEn = document.getElementById('qmQen').value.trim();
        if (!qEn) { showToast('English question text is required', 'error'); return; }

        // Build choices
        const choices = [];
        for (let i = 0; i < 4; i++) {
            choices.push({
                en: document.getElementById('qmC' + i + 'en').value.trim(),
                ja: document.getElementById('qmC' + i + 'ja').value.trim(),
                zh: document.getElementById('qmC' + i + 'zh').value.trim(),
                es: document.getElementById('qmC' + i + 'es').value.trim()
            });
        }
        if (!choices[0].en || !choices[1].en) { showToast('At least 2 choices required (English)', 'error'); return; }

        const editId = document.getElementById('qEditId').value;
        const qObj = {
            id: editId || (cat + '_' + lv + '_' + Date.now()),
            q: {
                en: qEn,
                ja: document.getElementById('qmQja').value.trim(),
                zh: document.getElementById('qmQzh').value.trim(),
                es: document.getElementById('qmQes').value.trim()
            },
            c: choices.filter(c => c.en || c.ja),
            a: parseInt(document.getElementById('qmAns').value),
            trivia: {
                en: document.getElementById('qmTen').value.trim(),
                ja: document.getElementById('qmTja').value.trim(),
                zh: document.getElementById('qmTzh').value.trim(),
                es: document.getElementById('qmTes').value.trim()
            }
        };

        // Remove old if editing (may change category/level)
        if (editId) removeQuestionById(editId);

        // Ensure category/level arrays exist
        if (!quizData[cat]) quizData[cat] = {};
        if (!quizData[cat][lv]) quizData[cat][lv] = [];
        quizData[cat][lv].push(qObj);

        // Check size
        const sizeBytes = getQuizSizeBytes();
        if (sizeBytes > MAX_SIZE_BYTES) {
            showToast('‚ö†Ô∏è Data exceeds 50MB! Question saved but please reduce data size.', 'error');
        }

        saveQuizLocal();
        renderQuizPanel();
        closeModal();
        showToast(editId ? 'Question updated! Êõ¥Êñ∞„Åó„Åæ„Åó„Åü' : 'Question added! ËøΩÂä†„Åó„Åæ„Åó„Åü', 'success');
    }

    function deleteQuestion(id) {
        if (!confirm('Delete this question? „Åì„ÅÆÂïèÈ°å„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;
        if (removeQuestionById(id)) {
            saveQuizLocal();
            renderQuizPanel();
            showToast('Question deleted ÂâäÈô§„Åó„Åæ„Åó„Åü', 'success');
        }
    }

    function exportQuizJSON() {
        if (!quizData) { showToast('No data to export', 'error'); return; }
        const exportData = {
            _meta: {
                version: 1,
                lastUpdated: new Date().toISOString().split('T')[0],
                totalQuestions: countQuestions()
            },
            ...quizData
        };
        const json = JSON.stringify(exportData, null, 2);
        const blob = new Blob([json], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'quiz-questions.json';
        a.click();
        URL.revokeObjectURL(url);
        showToast('Quiz data exported! Replace data/quiz-questions.json and commit.', 'success');
    }

    /* --- Init --- */
    checkSession();
    loadQuizData();
    </script>

    <!-- Firebase config (for status check) -->
    <script src="js/firebase-config.js"></script>
</body>
</html>